<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SGIP All-Tracks Calculator (HTML-Only)</title>
  <style>
    /*————————  Minimal, inline, works from a local file  ————————*/
    *,*:before,*:after{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#f6f8fa;color:#1e293b;line-height:1.5;min-height:100vh;display:flex;flex-direction:column}
    h1{font-size:clamp(1.75rem,4vw,2.5rem);text-align:center;margin:2rem 1rem .75rem;font-weight:700;color:#0f172a;position:relative}
    h1:after{content:"";display:block;width:4rem;height:4px;background:#f4b000;margin:.75rem auto 0}
    h2{font-size:1.2rem;margin:1.5rem 0 .5rem;font-weight:700;color:#0f172a}
    label{font-weight:600;display:block;margin-bottom:.25rem}
    input,select{width:100%;padding:.6rem;border:1px solid #cbd5e1;border-radius:.5rem;font-size:.95rem}
    input:focus,select:focus{outline:2px solid #94a3b8}
    button{margin-top:1rem;background:#004b87;color:#fff;border:none;border-radius:.5rem;padding:.75rem 1.5rem;font-weight:600;cursor:pointer}
    button:hover{background:#003460}
    .container{max-width:1100px;margin:0 auto;padding:1rem;flex:1}
    .card{background:#fff;border-radius:1rem;box-shadow:0 4px 12px rgba(0,0,0,.06);padding:2rem;margin-bottom:2rem}
    table{width:100%;border-collapse:collapse;font-size:.85rem;margin-top:1rem}
    th,td{border:1px solid #cbd5e1;padding:.4rem;text-align:center}
    th{background:#f4b000;color:#fff}
    .hidden{display:none}
    ul.docs{margin-top:.75rem;padding-left:1.2rem;font-size:.9rem}
    ul.docs li{list-style:disc;margin:.25rem 0}
  </style>
</head>
<body>
  <h1>California SGIP Calculator – All Programs</h1>

  <div class="container">
    <!-- ►► CALCULATOR FORM ◄◄ -->
    <div class="card">
      <form id="calcForm" autocomplete="off">
        <!-- CUSTOMER -->
        <h2>Site &amp; Customer</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:1rem">
          <div><label for="utility">Utility</label><select id="utility" required>
            <option value="">Select…</option><option>PG&E</option><option>SCE</option><option>SDG&E</option><option>SoCalGas</option><option>LADWP</option></select></div>
          <div><label for="customerType">Customer Class</label><select id="customerType" required>
            <option value="">—</option><option value="res-sf">Single-Family</option><option value="res-mf">Multifamily</option><option value="commercial">Commercial</option><option value="gov">Gov/Tribal/Edu/Non-Profit</option><option value="smallbiz">Small Business</option></select></div>
          <div><label for="lowIncome">Low-Income?</label><select id="lowIncome" required><option value="">—</option><option value="yes">Yes</option><option value="no">No</option></select></div>
          <div><label for="dac">In DAC?</label><select id="dac" required><option value="">—</option><option value="yes">Yes</option><option value="no">No</option></select></div>
          <div><label for="hftd">HFTD / PSPS events?</label><select id="hftd" required><option value="">—</option><option value="yes">Yes</option><option value="no">No</option></select></div>
          <div><label for="critical">Critical Facility?</label><select id="critical" required><option value="">—</option><option value="yes">Yes</option><option value="no">No</option></select></div>
          <div><label for="sjv">San Joaquin Valley city?</label><select id="sjv" required><option value="">—</option><option value="yes">Yes</option><option value="no">No</option></select></div>
        </div>

        <!-- SYSTEM -->
        <h2>System Details</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem">
          <div><label for="tech">Technology</label><select id="tech" required><option value="">—</option><option value="storage">Storage Only</option><option value="pv+storage">Solar + Storage</option><option value="generation">Standalone Generation</option></select></div>
          <div><label for="capacity">Battery kWh</label><input id="capacity" type="number" min="0" step="0.1" value="13.5" required></div>
          <div><label for="pv">Solar kW</label><input id="pv" type="number" min="0" step="0.1" value="5"></div>
          <div><label for="itc">Claiming ITC?</label><select id="itc" required><option value="">—</option><option value="yes">Yes</option><option value="no">No</option></select></div>
        </div>

        <button type="submit">Estimate Incentive</button>
      </form>
    </div>

    <!-- ►► RESULT ◄◄ -->
    <div id="result" class="card hidden"></div>

    <!-- ►► STATIC RATE TABLE ◄◄ -->
    <div class="card">
      <h2>Snapshot of Core Rates (check selfgenca.com for current step)</h2>
      <table>
        <tr><th>Track</th><th>Rate</th></tr>
        <tr><td>RSSE Storage</td><td>$1.10 / Wh</td></tr>
        <tr><td>RSSE Solar</td><td>$3.10 / W</td></tr>
        <tr><td>Residential Storage Equity</td><td>$0.85 / Wh</td></tr>
        <tr><td>Equity Resiliency</td><td>$1.00 / Wh</td></tr>
        <tr><td>Non-Res Storage Equity</td><td>$0.85 / Wh <small>(flat)</small></td></tr>
        <tr><td>Non-Res Equity Resiliency</td><td>$1.00 / Wh</td></tr>
        <tr><td>Small Residential GM (Step 7)</td><td>$0.15 / Wh</td></tr>
        <tr><td>Large-Scale GM (Step 5)</td><td>$0.30 / Wh</td></tr>
        <tr><td>Large-Scale GM + ITC</td><td>$0.22 / Wh</td></tr>
        <tr><td>SJV (pilot)</td><td>$1.00 / Wh ✱</td></tr>
        <tr><td>Generation Base</td><td>$2.00 / W</td></tr>
        <tr><td>Generation Resiliency Adder</td><td>+ $2.50 / W</td></tr>
      </table>
      <p style="font-size:.8rem;margin-top:.5rem">✱ Pending CPUC approval of final SJV rate.</p>
    </div>
  </div>

  <!-- ►► LOGIC ◄◄ -->
  <script>
    const rates={
      rsseS:1.10, rssePV:3.10,
      resEq:0.85, equRes:1.00,
      nonResEq:0.85, nonResEquRes:1.00,
      sjv:1.00,
      smallRes:0.15, large:0.30, largeITC:0.22,
      gen:2.00, genAdder:2.50
    };

    function $(id){return document.getElementById(id)}
    function yes(id){return $(id).value==='yes'}

    function decideTrack(){
      const c=$('customerType').value,
            li=yes('lowIncome'), dac=yes('dac'), h=yes('hftd'), crit=yes('critical'), sjv=yes('sjv');

      // — Residential Single / Multifamily —
      if(c.startsWith('res')){
        if(li){return{t:'RSSE', rS:rates.rsseS, rPV:rates.rssePV}}
        if(dac&&h){return{t:'Equity Resiliency', rS:rates.equRes}}
        if(dac||li){return{t:'Residential Storage Equity', rS:rates.resEq}}
        if(c==='res-sf'){return{t:'General Market – Small Residential', rS:rates.smallRes}}
        return{t:'General Market – Multifamily (Large-Scale)', rS:rates.large}
      }

      // — San Joaquin Valley pilot overrides —
      if(sjv){return{t:'San Joaquin Valley Pilot', rS:rates.sjv}}

      // — Non-Residential —
      const crit1 = ['gov','smallbiz'].includes(c) || yes('lowIncome'); // simplified representation
      if(crit1 && dac){
        if(h && crit){return{t:'Non-Res Equity Resiliency', rS:rates.nonResEquRes}}
        return{t:'Non-Res Storage Equity', rS:rates.nonResEq}
      }
      // General-Market large-scale
      return{t:'General Market – Large-Scale', rS:rates.large}
    }

    $('calcForm').addEventListener('submit',e=>{
      e.preventDefault();
      const tech=$('tech').value, cap=parseFloat($('capacity').value)||0, pv=parseFloat($('pv').value)||0, itc=yes('itc');
      const t=decideTrack();
      let msg=`<h2>Preliminary Eligibility</h2><p>You appear to qualify for <strong>${t.t}</strong>.</p>`;
      let total=0;

      // STORAGE
      if(tech.includes('storage')){
        let rate=t.rS;
        if(t.t.includes('Large-Scale') && itc){rate=rates.largeITC}
        const storageUSD=cap*rate;
        total+=storageUSD;
        msg+=`<p>Storage incentive: <strong>$${storageUSD.toLocaleString()}</strong> (${rate.toFixed(2)} $/Wh)</p>`;
      }
      // SOLAR
      if(tech==='pv+storage' && t.rPV){
        const solarUSD=pv*t.rPV;
        total+=solarUSD;
        msg+=`<p>Solar incentive: <strong>$${solarUSD.toLocaleString()}</strong> (${t.rPV.toFixed(2)} $/W)</p>`;
      }
      // GENERATION
      if(tech==='generation'){
        const base= pv*rates.gen; // treat pv field as generation kW
        const add = (yes('hftd') && yes('critical')) ? pv*rates.genAdder : 0;
        total+=base+add;
        msg+=`<p>Generation incentive: <strong>$${base.toLocaleString()}</strong> base ${add?`+ $${add.toLocaleString()} resiliency adder`:''}</p>`;
      }

      msg+=`<p style="margin-top:.5rem;font-weight:700">≈ Estimated Total Rebate: $${total.toLocaleString()}</p>`;

      // DOCUMENTATION — Always show RR, PPM, ICF bullets
      const docs=[
        'Online Reservation Request Form (RRF)',
        'Proof of Utility Service (recent bill)',
        'Executed Contract / Purchase Agreement',
        'Load Documentation (if storage > thresholds)',
        'Preliminary Monitoring Plan (>=30 kW gen or PBI projects)',
        'Proof of Eligibility (Equity / Resiliency / SJV as applicable)',
        'Customer Resiliency Attestation (if claiming resiliency)',
        'Application Fee (non-residential, 5 % of incentive)',
        'Proof of Authorization to Interconnect (PTO) at ICF stage',
        'Building Inspection Report (where required)'
      ];
      msg+=`<h2 style="margin-top:1.5rem">Core Documentation Checklist</h2><ul class="docs">${docs.map(d=>`<li>${d}</li>`).join('')}</ul>`;

      $('result').innerHTML=msg;
      $('result').classList.remove('hidden');
      $('result').scrollIntoView({behavior:'smooth'});
    });
  </script>
</body>
</html>
